<div class="max-w-7xl mx-auto p-4 space-y-6">
  <!-- =========================
    Header local (opcional)
  ========================== -->
  @if (showHeader) {
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-extrabold text-sky-700">Sistema de Gestión KONEX</h1>
        <p class="text-gray-500">Inventario y ventas de medicamentos para droguerías</p>
      </div>
      <button
        (click)="abrirCrear()"
        class="px-4 py-2 rounded-xl bg-sky-600 text-white shadow hover:bg-sky-700"
        aria-label="Agregar medicamento">
        + Agregar Medicamento
      </button>
    </div>
  }

  <!-- =========================
    KPIs
  ========================== -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <app-card-metric label="Medicamentos Almacenados" hint="Total" [value]="totalMedicamentos()">
      <span metric-icon>
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v2H4zM4 11h16v2H4zM4 18h16v2H4z"/></svg>
      </span>
    </app-card-metric>

    <app-card-metric label="Stock Total" [value]="stockTotal()" hint="página actual">
      <span metric-icon>
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5a2 2 0 00-2 2v11h2V5h14v11h2V5a2 2 0 01-2-2zM3 19h18v2H3z"/></svg>
      </span>
    </app-card-metric>

    <app-card-metric label="Stock Bajo" [value]="stockBajo()" hint="&lt; 10">
      <span metric-icon>
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>
      </span>
    </app-card-metric>

    <app-card-metric label="Ingresos del Mes" [value]="ingresosMes() | currencyCol" hint="mes actual">
      <span metric-icon>
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 1l3 5h-6l3-5zM3 13h18v8H3z"/>
        </svg>
      </span>
    </app-card-metric>
  </div>

  <!-- =========================
    Filtros
  ========================== -->
  <div class="flex items-center gap-2">
    <input
      type="text"
      class="w-72 rounded-xl border px-3 py-2"
      placeholder="Buscar por nombre..."
      [value]="filtroNombre()"
      (input)="onFiltroChange($any($event.target).value)"
      aria-label="Buscar medicamento por nombre"
    />
    <button
      (click)="buscar()"
      class="px-3 py-2 rounded-xl bg-gray-900 text-white"
      aria-label="Ejecutar búsqueda por nombre">
      Buscar
    </button>
  </div>

  <!-- =========================
    Tabla resultados
  ========================== -->
 <app-medicamentos-table
  [medicamentos]="rows()"
  [loading]="loading()"
  [totalOverride]="totalMedicamentos()"
  [lowStockThreshold]="10"
  (vender)="abrirVender($event)"
  (editar)="abrirEditar($event)"
  (eliminar)="eliminar($event)">
</app-medicamentos-table>


  <!-- =========================
    Paginación
  ========================== -->
  <div class="flex items-center justify-between">
    <div class="text-sm text-gray-500">
      Página {{ (data()?.number ?? 0) + 1 }} de {{ data()?.totalPages ?? 1 }}
    </div>
    <div class="flex gap-2">
      <button class="px-3 py-1 rounded-lg border" (click)="paginar(false)" aria-label="Página anterior">
        Anterior
      </button>
      <button class="px-3 py-1 rounded-lg border" (click)="paginar(true)" aria-label="Página siguiente">
        Siguiente
      </button>
    </div>
  </div>

  <!-- =========================
    Modal Crear/Editar
  ========================== -->
  <app-modal
    [open]="showForm()"
    [title]="editando ? 'Editar Medicamento' : 'Nuevo Medicamento'"
    (close)="showForm.set(false)">
    <app-medicamento-form
      [initial]="editando"
      (save)="onGuardar($event)"
      (cancel)="showForm.set(false)">
    </app-medicamento-form>
  </app-modal>

  <!-- =========================
    Dialog Vender
  ========================== -->
  <app-vender-dialog
    [open]="showVender()"
    [seleccionado]="seleccionado"
    [cotizacion]="cotizacion"
    [loading]="vendiendo()"
    (cerrar)="showVender.set(false)"
    (cotizar)="cotizar($event)"
    (confirmar)="confirmarVenta($event)">
  </app-vender-dialog>
</div>
