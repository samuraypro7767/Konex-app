<!-- Header superior -->
<header class="flex items-center justify-between px-6 py-3 shadow-sm bg-white">
  <!-- Logo + texto -->
  <div class="flex items-center gap-2">
    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-sky-600 text-white font-bold">
      K
    </div>
    <div>
      <div class="text-sky-700 font-bold">KONEX</div>
      <div class="text-xs text-gray-500 -mt-1">Gestión de Medicamentos</div>
    </div>
  </div>

  <!-- Botón + notificación -->
  <div class="flex items-center gap-4">
    <button
      *ngIf="tab() === 'inventario'"
      (click)="abrirDesdeHeader()"
      class="px-4 py-2 rounded-xl bg-sky-600 text-white shadow hover:bg-sky-700">
      + Agregar Medicamento
    </button>

    <!-- Campana -->
    <div class="relative" (click)="$event.stopPropagation()">
      <button
        class="relative p-1 rounded-lg hover:bg-gray-100"
        aria-label="Notificaciones"
        (click)="toggleNotifs($event)">
        <span class="material-icons text-gray-700">
          {{ showNotif() ? 'notifications' : 'notifications_none' }}
        </span>

        <!-- Punto rojo si hay 'unread' y el panel NO está abierto -->
        <span
          *ngIf="unread() > 0 && !showNotif()"
          class="absolute -top-0.5 -right-0.5 h-2.5 w-2.5 bg-red-500 rounded-full ring-2 ring-white">
        </span>
      </button>

      <!-- Dropdown de notificaciones -->
      <div
        *ngIf="showNotif()"
        class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border z-50"
        (click)="$event.stopPropagation()">

        <div class="p-3 border-b font-semibold">Notificaciones</div>

        <ul class="max-h-80 overflow-auto divide-y">
          <li
            *ngFor="let n of notifs(); trackBy: trackNotif"
            class="p-3 flex gap-3">
            <span
              class="material-icons text-sm mt-0.5"
              [ngClass]="{
                'text-red-500': n.type === 'danger',
                'text-amber-500': n.type === 'warning',
                'text-sky-600': n.type === 'info'
              }">
              {{ n.type === 'danger' ? 'error' : (n.type === 'warning' ? 'warning' : 'info') }}
            </span>
            <div class="text-sm">
              <div class="font-medium">{{ n.title }}</div>
              <div class="text-gray-500" *ngIf="n.detail">{{ n.detail }}</div>
              <div class="text-xs text-gray-400 mt-1">{{ n.createdAt | date:'short' }}</div>
            </div>
          </li>

          <li *ngIf="notifs().length === 0" class="p-6 text-center text-gray-500">
            Sin alertas
          </li>
        </ul>
      </div>
    </div>
  </div>
</header>

<!-- Contenido principal -->
<div class="relative max-w-7xl mx-auto p-6 space-y-8">
  <!-- Título centrado -->
  <div class="text-center">
    <h1 class="text-5xl font-semibold text-sky-700 tracking-tight">
      Sistema de Gestión KONEX
    </h1>
    <p class="text-gray-500 mt-2">
      Inventario y ventas de medicamentos para droguerías
    </p>
  </div>

  <!-- Tabs -->
  <div class="flex w-full justify-center">
    <div class="bg-gray-100 rounded-full p-1 inline-flex shadow-inner">
      <button
        class="px-6 py-2 rounded-full transition"
        [class.bg-white]="tab()==='inventario'"
        [class.shadow]="tab()==='inventario'"
        (click)="seleccionar('inventario')">
        🧱 Inventario
      </button>
      <button
        class="px-6 py-2 rounded-full transition"
        [class.bg-white]="tab()==='ventas'"
        [class.shadow]="tab()==='ventas'"
        (click)="seleccionar('ventas')">
        🛒 Ventas
      </button>
    </div>
  </div>

  <!-- Contenido -->
  @if (tab()==='inventario') {
    <app-inventario-page #inv [showHeader]="false"></app-inventario-page>
  } @else {
    <app-ventas-page [showHeader]="false"></app-ventas-page>
  }
</div>
